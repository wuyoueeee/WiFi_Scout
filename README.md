项目获取地址：[https://mbd.pub/o/bread/mbd-YZWZlptsag==](https://mbd.pub/o/bread/mbd-YZWZlptsag==)
项目演示地址：[https://www.bilibili.com/video/BV13xUTBbEmn/?share_source=copy_web&vd_source=cbebe19736fd5a34699d8baa3788e19b](https://www.bilibili.com/video/BV13xUTBbEmn/?share_source=copy_web&vd_source=cbebe19736fd5a34699d8baa3788e19b)

本项目是一个基于WiFi的的室内定位系统（Indoor Positioning System, IPS）综合仿真平台。

本项目旨在解决室内定位研究中“环境搭建难、数据采集耗时、算法对比不直观”的痛点。通过构建高保真的 WiFi 信号传播模型（包括墙体衰减与阴影衰落），结合可视化的人机交互界面，实现了从**环境建模**、**指纹采集**、**算法定位**到**动态轨迹评测**的全流程闭环仿真。

本系统支持实时对比 KNN、WKNN、朴素贝叶斯及改进型自适应混合算法的性能差异。

---
![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/767fbb98fcb046f4b1e6408546b0dad7.png#pic_center)

## 📚 目录

1.  [系统功能模块详解](#-系统功能模块详解)
2.  [物理信道仿真模型](#-物理信道仿真模型)
3.  [核心定位算法原理](#-核心定位算法原理)
4.  [动态评测体系](#-动态评测体系)
5.  [快速开始](#-快速开始)

---

## 🏛️ 系统功能模块详解

本系统采用模块化设计，主要包含以下五大核心功能模块：

### 1. 可视化环境建模模块 (Visual Environment Modeling)
此模块负责构建仿真的物理世界，提供类似 CAD 的操作体验。
*   **多层图层渲染**：支持导入真实户型平面图（图片格式），提供透明度、缩放、位移的实时调节功能，确保坐标系与真实物理尺寸（1px = 0.05m）精确对齐。
*   **智能墙体绘制**：
    *   支持连续折线绘制（Polyline Drawing）与正交模式（Ortho Mode），可快速勾勒房间轮廓。
    *   **物理属性绑定**：墙体不仅仅是线条，还绑定了衰减系数（如混凝土墙 10dB，石膏板 3dB），直接参与后续的信号计算。
    *   **网格吸附**：提供精准的网格对齐功能，保证建模的规范性。

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/d1cf56e1dc0d401592676a4f38401625.png#pic_center)

### 2. 无线网络部署与物理仿真模块 (Network & Physics Engine)
此模块模拟无线信号在室内空间的传播特性，是整个仿真的基石。
*   **基站 (AP) 参数化配置**：
    *   支持自定义 AP 的名称、**发射功率 (Tx Power)**（-50dBm ~ 0dBm）及信道频率（2.4GHz/5GHz）。
    *   功率调整将直接改变信号的覆盖半径。
*   **高精度信号热力图**：
    *   采用 **网格射线追踪 (Grid-based Ray Casting)** 技术，将地图划分为细粒度网格。
    *   实时计算每个网格点与所有 AP 之间的视距 (LOS) 及墙体阻挡情况。
    *   渲染出带有**阴影效应 (Shadowing Effect)** 的真实信号分布图，直观展示信号盲区。
![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/2c03ee3cb3f64c6fb5236d71239e40b9.png#pic_center)

### 3. 指纹数据库管理模块 (Fingerprint Database Management)
此模块模拟 IPS 系统中的“离线采集阶段 (Offline Phase)”。
*   **虚拟路测工具**：
    *   用户可在地图任意位置模拟手持终端进行信号采集。
    *   **HUD 实时质量检测**：光标旁实时显示当前位置可见的 AP 数量及信号质量（Excellent/Good/Weak），防止采集无效数据。
*   **频谱可视化录入**：
    *   采集弹窗提供实时的信号频谱柱状图，展示 Top-N 强信号源。
    *   支持**智能递增命名**（如 Office-1 -> Office-2），大幅提升采集效率。
![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/fe0b7f8a62b943c59233ca2235364c98.png#pic_center)

### 4. 智能定位分析引擎 (Positioning Analysis Engine)
此模块模拟“在线定位阶段 (Online Phase)”，是算法验证的核心。
*   **实时定位测试**：点击地图任意位置生成测试信号向量，系统自动调用选定算法进行解算。
*   **算法黑盒可视化**：
    *   **数学推导展示**：详细列出算法的决策过程（如 KNN 的邻居列表、WKNN 的权重计算、贝叶斯的概率分布）。
    *   **邻居高亮**：在地图上动态高亮参与计算的 Top-K 指纹点，用连接线直观展示定位依据。
![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/5d524093a5e0462dba63ec90bb4c3cf2.png#pic_center)

### 5. 动态轨迹评测模块 (Dynamic Trajectory Evaluation)
此模块用于量化评估不同算法在移动场景下的性能，直接生成科研图表数据。
*   **多段路径规划**：支持在地图上绘制复杂的行走路线（Waypoints），系统通过插值算法生成连续的测试点序列。
*   **多算法并行竞演**：
    *   仿真过程中，系统针对同一组观测数据，**并行运行** KNN、WKNN、Adaptive WKNN 和 Naive Bayes 四种算法。
    *   在地图上同时绘制出真实轨迹（Ground Truth，绿色）与各算法的预测轨迹（彩色）。
*   **实时误差看板**：
    *   实时计算并显示各算法的 **平均绝对误差 (MAE)** 和 **均方根误差 (RMSE)**。
    *   提供排行榜视图，动态展示哪种算法在当前环境下表现最优。
![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/9f048132c73e41ee94c8b83dd0e83659.png#pic_center)

---

## 📐 物理信道仿真模型

为了生成逼真的 RSSI (Received Signal Strength Indication) 数据，本系统采用了 **对数距离路径损耗模型 (Log-Distance Path Loss Model)** 并扩展了 **多墙体模型 (Multi-Wall Model)**。

核心公式如下：

$$ RSSI(d) = P_{tx} - 10 \cdot n \cdot \log_{10}(d) - \sum_{k=1}^{M} L_{wall} + X_\sigma $$

其中：
*   **$P_{tx}$**: 基站发射功率 (通常为 -30dBm 到 0dBm)。
*   **$n$**: 路径损耗指数 (Path Loss Exponent)。
    *   自由空间 $n=2.0$
    *   典型办公环境 $n=2.5 \sim 4.0$ (本系统支持动态调节)。
*   **$d$**: 欧氏距离 (米)。
*   **$L_{wall}$**: 墙体衰减因子。系统通过**线段相交算法**计算视距路径 (LOS) 穿过的墙体数量 $M$，每层墙体带来额外的 $L_{wall}$ 衰减 (如 5dB)。
*   **$X_\sigma$**: 阴影衰落随机变量，服从高斯分布 $N(0, \sigma^2)$，用于模拟多径效应和环境噪声。

---

## 🧠 核心定位算法原理

本系统内置了四种具有代表性的指纹定位算法，涵盖了确定性、概率性及改进型方法。

### 1. K-最近邻算法 (Standard KNN)
*   **基本原理**：在信号空间中计算观测向量 $S$ 与指纹库中参考点 $F_i$ 的**欧氏距离**，选取距离最小的 $K$ 个邻居。
*   **位置估计**：$$ (x, y) = \frac{1}{K} \sum_{i=1}^{K} (x_i, y_i) $$
*   **系统评价**：基准算法，计算快，但易受噪声干扰，产生较大的定位跳变。

### 2. 加权 K-最近邻算法 (WKNN)
*   **基本原理**：在 KNN 基础上引入距离反比权重，距离越近，权重越大。
*   **权重公式**：$$ w_i = \frac{1}{d_i + \epsilon} $$
*   **系统评价**：工业界常用算法，平滑度优于 KNN。

### 3. 自适应混合加权算法 (Adaptive Hybrid WKNN) 🔥 *[改进创新点]*
这是本系统的核心改进算法，旨在解决传统欧氏距离在高噪声环境下的不稳定性。

*   **混合度量**：融合欧氏距离与**余弦相似度 (Cosine Similarity)**。$$ Cost_i = \frac{Euclidean(S, F_i)}{Cosine(S, F_i)^2} $$
*   **高斯核权重**：使用高斯函数 $$ w_i = e^{-\frac{Cost_i^2}{2\sigma^2}} $$ 替代简单的倒数权重，对非相似点具有更强的抑制作用。
*   **系统评价**：对抗设备异构和信号整体波动的能力最强，定位轨迹最平滑。

### 4. 朴素贝叶斯算法 (Naïve Bayes)
*   **基本原理**：基于概率论的生成式模型。假设各 AP 信号相互独立，计算在位置 $L_i$ 观测到信号向量 $S$ 的后验概率 $P(L_i | S)$。
*   **系统评价**：在信号波动符合高斯分布时理论精度最高，但计算量相对较大。

---

## 📈 动态评测体系

为了量化评估算法性能，系统提供了**轨迹仿真模式 (Trajectory Simulation Mode)**。

1.  **Ground Truth 生成**：通过插值算法在地图上生成连续的行走路径点。
2.  **蒙特卡洛仿真**：在路径的每一步，系统基于物理模型生成带噪声的信号样本。
3.  **并行推演**：同时运行 4 种算法进行位置预测。
4.  **误差统计**：
    *   **MAE (Mean Absolute Error)**: 平均定位误差，反映普遍精度。
    *   **RMSE (Root Mean Square Error)**: 均方根误差，对大误差（“跳变”）更敏感，反映稳定性。

---

## 🚀 快速开始

### 1. 安装依赖
确保已安装 Node.js (v16+)。
```bash
npm install
```

### 2. 启动开发环境
```bash
npm run dev
```
访问 `http://localhost:5173`。

### 3. 推荐演示流程 (Demo Flow)
1.  **导入**：点击“导入户型图”，上传一张室内平面图。
2.  **建墙**：使用“绘制墙体”工具，沿着户型图轮廓画墙（右键结束）。
3.  **部署**：在不同房间放置 3-4 个 AP。
4.  **配置**：打开设置面板，开启“信号热力图”，观察墙体对信号的阻挡效果。
5.  **采集**：切换到“采集指纹”，在地图上每隔 2-3 米点击一次，录入数据。
6.  **仿真**：
    *   切换到“轨迹仿真”模式。
    *   在地图上点击起点、转折点和终点。
    *   右键点击结束绘制，系统将自动开始模拟行走。
    *   观察右侧“算法性能竞技场”的实时排名和误差数据。

---


